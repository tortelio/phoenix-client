{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/application.js","src/event.js","src/phoenix.js","src/phoenix/index.js","src/webSocketHandler.js"],"names":[],"mappings":"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","file":"application.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import Phoenix from \"./phoenix\"\n\nlet url = \"ws://0.0.0.0:8080/websocket\";\n\nvar Application = new Phoenix(url),\n    ApplicationElement = document.getElementById(\"application\");\n\nm.route.mode = \"hash\";\nm.route(ApplicationElement, \"/\", {\n  \"/\": Application.index,\n  \"/users/:userId\": Application.users\n});\n","class Event {\n  constructor(name) {\n    this.callbacks = []\n  }\n\n  registerCallback(callback) {\n    this.callbacks.push(callback);\n  }\n\n  unregisterCallback(callback) {\n    this.callbacks.filter(x => x == callback);\n  }\n}\n\nexport default Event\n","import WebSocketHandler from \"./webSocketHandler\"\nimport Index from \"./phoenix/index\"\n\nclass Phoenix {\n  constructor(url) {\n    this.wsh = new WebSocketHandler(url);\n    this.index = Index.init();\n  }\n}\n\nexport default Phoenix\n","\nclass User{\n  constructor(name = m.prop(\"\")) {\n    this.name = name;\n  }\n}\n\nlet Index = {\n  init(wsh) {\n    this.wsh = wsh;\n  }\n};\n\nIndex.controller = function() {\n  let user = new User();\n  return {\n    user,\n    login(e) {\n      console.log(user.name());\n    }\n  };\n};\n\nIndex.view = function(ctrl) {\n  return [\n    m(\"input\", {value: ctrl.user.name(), onchange: m.withAttr(\"value\", ctrl.user.name)}),\n    m(\"button\", {onclick: e => ctrl.login(e)}, \"Log in\")\n  ];\n};\n\nexport default Index\n","import Event from \"./event\"\n\nclass WebSocketHandler {\n  constructor(hostname) {\n    this.ready = false;\n    this.ws = new WebSocket(hostname);\n    this.ws.addEventListener(\"open\", event => this.onopen);\n  }\n\n  onopen() {\n    this.events = [];\n    this.ws.addEventListener(\"message\",  event => this.onmessage);\n    this.ready = true;\n  }\n\n  send(data) {\n    let serializedData = JSON.stringify(data);\n    this.ws.send(serializedData);\n  }\n\n  registerEvent(event) {\n    this.events[event] = new Event(event);\n  }\n\n  addEventListener(event, callback) {\n    if(! this.events.hasOwnProperty(event)) { this.registerEvent(event); }\n    this.events[event].registerCallback(callback);\n  }\n\n  removeEventListener(event, callback) {\n    if(this.events.hasOwnProperty(event)) {\n      let index = this.events[event].callbacks.indexOf(callback);\n      if(index == -1) {\n        console.error(`Tried to remove an unregistered callback function`);\n      } else {\n        if(this.events[event].callbacks.length == 1) {\n          delete this.events[event];\n        } else {\n          this.events[event].callbacks[index] = this.events[event].callbacks.pop();\n        }\n      }\n    }\n  }\n\n  onmessage(event) {\n    let data = JSON.parse(e.data);\n    this.dispatchEvent(date.type, data);\n  }\n\n  dispatchEvent(event, state) {\n    if(this.events.hasOwnProperty(event)) {\n      this.events[event].callbacks.map(callback => callback(state));\n    } else {\n      console.error(`${event} is not registered.`);\n    }\n  }\n}\n\nexport default WebSocketHandler;\n"]}